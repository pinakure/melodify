<!-- main/lyrics.html -->
{% load static %}
{% load fontawesome_5 %}
{% include "main/widget-back.html" %}
<style>
    #subtitleEditor {
        height: 400px; /* Altura fija para que el scrollIntoView funcione */
        overflow-y: auto;
        border: 1px solid #ddd;
        padding: 10px;
        background: #f9f9f9;
    }

    .timeline-segment:hover {
        background: #357ABD !important; /* Oscurecer al pasar el mouse */
        z-index: 10;
    }
</style>
{%include 'main/widget-title.html' with caption="Editor de Lyrics" %}
<input type="file" id="srtFileInput" accept=".srt">
<div id="subtitleEditor" style="margin-top: 20px;"></div>
<!-- Contenedor principal de la línea de tiempo -->
<div id="timelineContainer" style="width: 100%; overflow-x: auto; background: #333; height: 120px; position: relative; margin-bottom: 20px; border-radius: 8px;">
    <div id="timelineTrack" style="position: relative; height: 100%; min-width: 100%;">
        <!-- Los bloques de subtítulos se insertarán aquí -->
    </div>
</div>
<button id="downloadBtn" style="display:none; margin-top: 20px;">Guardar y Descargar .SRT</button>

<script src="{% static 'js/srt_editor.js' %}"></script>


<script>
    document.getElementById('srtFileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            processSRT(content);
        };
        reader.readAsText(file);
    });

    // Función para reconstruir el SRT y descargarlo
    document.getElementById('downloadBtn').addEventListener('click', function() {
        const blocks = document.querySelectorAll('.subtitle-block');
        let srtResult = '';

        blocks.forEach((block, index) => {
            const id = index + 1;
            const time = block.querySelector('.time-input').value;
            const text = block.querySelector('.text-input').value;

            srtResult += `${id}\n${time}\n${text}\n\n`;
        });

        downloadFile(srtResult, "subtitulos_editados.srt");
    });
</script>