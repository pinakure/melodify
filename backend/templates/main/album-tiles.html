<!-- templates/app/album_tiles.html -->

{% extends 'base.html' %} 

{% block header %}
<style>
    /* 
      Nota: Algunos de estos estilos tienen colores como #ccc, #f9f9f9, #666, #888, #eee.
      Para que se integren perfectamente con tu base.html de modo oscuro, 
      deber칤as cambiarlos por las variables CSS que definimos: 
      var(--border-color), var(--bg-sidebar), var(--text-color), etc. 
      Los he dejado como estaban en tu c칩digo original para la revisi칩n.
    */

    .tile-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        padding: 20px 0; /* Ajustado el padding superior */
    }

    .tile-item {
        border: 1px solid #ccc;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s;
        text-align: center;
    }

    .tile-item:hover {
        transform: translateY(-5px);
    }

    .tile-item img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        display: block;
    }

    .placeholder-image {
        width: 100%;
        height: 200px;
        background-color: var(--tile-placeholder);
        display: flex;
        align-items: center;
        font-size: 128px;
        justify-content: center;
        color: #888;
    }

    .tile-info {
        padding: 15px 10px;
        background-color: var(--tile-info);
    }

    .tile-info h3 {
        margin: 0 0 5px 0;
        font-size: 1.1em;
        /* color: black; para asegurar visibilidad si el fondo es claro */
    }

    .tile-info p {
        margin: 0;
        color: #666;
        font-size: 0.9em;
    }

    .tile-item a {
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .album-image{
        width: 100%;
        height: 200px;
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Nuevos estilos para la b칰squeda */
    .header-with-search {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0px;
    }
    #albumSearchInput {
        padding: 8px 12px;
        font-size: 1em;
        background-color: var(--bg-sidebar);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        color: var(--text-color);
    }
</style>
{% endblock %}

{% block search %}
    <input type="text" id="albumSearchInput" placeholder="Filtrar 치lbumes..." onkeyup="filterAlbums()">
{% endblock %}

{% block content-title %}츼lbumes (<span id="album-count">{{ albums.count }}</span>){% endblock %}

{% block content %}
<div class="tile-container" id="tileContainer">
    {% for album in albums %}
        <div class="tile-item album-item" data-album-artist="{% if album.artists.all.count > 3 %}various Artists{% else %}{% for artist in album.artists.all %}{{artist.name | lower }} {% endfor %}{% endif %}" data-album-name="{{ album.name|lower }}">
            <a href="{% url 'album-detail' album.pk %}">
                {% if album.picture %}
                    <div class="album-image" style="background-image: url('{{ album.picture }}')" alt="{{ album.name }} cover"></div>
                {% else %}
                    <div class="placeholder-image">游</div>
                {% endif %}
                <div class="tile-info">
                    <h3>{{ album.name }}</h3>
                    {% if album.artists.all.count > 3 %}
                        <p>Various Artists</p>
                    {% else %}
                        {% for artist in album.artists.all %}
                        <p>
                            {{artist.name}}
                        </p>
                        {% endfor %}
                    {% endif %}
                </div>
            </a>
        </div>
    {% empty %}
        <p id="no-albums-message">No se encontraron 치lbumes.</p>
    {% endfor %}
</div>

<!-- Scripts de JavaScript para el filtrado -->
<script>
    function filterAlbums() {
        // Obtener el valor de b칰squeda y convertirlo a min칰sculas
        const input = document.getElementById('albumSearchInput');
        const counter = document.getElementById('album-count');
        const filter = input.value.toLowerCase();
        
        // Obtener todos los elementos de la lista de 치lbumes
        const albumCards = document.querySelectorAll('.album-item');
        const noAlbumsMessage = document.getElementById('no-albums-message');
        
        let found = false;
        let count = 0;
        // Iterar sobre todas las tarjetas y ocultar las que no coinciden
        albumCards.forEach(card => {
            const name = card.getAttribute('data-album-name').toLowerCase();
            const artist = card.getAttribute('data-album-artist').toLowerCase();
            
            if (name.includes(filter) ||artist.includes(filter)) {
                card.style.display = ""; // Mostrar el elemento (default block/grid item)
                found = true;
                count++;
            } else {
                card.style.display = "none"; // Ocultar el elemento
            }
        });
        counter.innerHTML = count;
        // Manejar el mensaje de "no encontrados" si es necesario
        if (noAlbumsMessage) {
            noAlbumsMessage.style.display = found ? "none" : "";
        }
    }
</script>

{% endblock %}
