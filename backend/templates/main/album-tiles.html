<!-- templates/app/album_tiles.html -->

{% extends 'base.html' %} 

{% block header %}
<style>
    .tile-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        padding: 20px 0; /* Ajustado el padding superior */
    }

    .tile-item {
        border: none;
        border-radius: 8px;
        overflow: hidden;
        /* box-shadow: 0 4px 6px rgba(0,0,0,0.1); */
        transition: transform 0.2s;
        text-align: center;
    }

    .tile-item:hover {
        /* transform: translateY(-5px); */
    } 

    .tile-item img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        display: block;
    }

    .tile-info {
        padding-left: 15px;
        padding-right: 15px;
        padding-bottom: 10px;
        background-color: var(--bg-content);
    }

    .tile-info p {
        margin: 0;
        color: var(--tile-info-text);
        font-size: 0.9em;
    }

    /* Album Name (fixed height) */
    h3.album-name {
        margin: 0 0 5px 0;
        font-size: 16px !important;   
        padding-bottom: 8px;
        height: 18px;
        overflow: hidden;
    }

    .tile-item a {
        text-decoration: none;
        color: inherit;
        display: block;
    }

   
    
    


</style>
{% endblock %}

{% block search %}
    <input type="text" id="searchInput" class="searchInput" placeholder="Filtrar √°lbumes..." onkeyup="filterAlbums()">
{% endblock %}

{% block content-title %}√Ålbumes (<span id="album-count">{{ albums.count }}</span>){% endblock %}

{% block content %}
<div class="tile-container" id="tileContainer">
    {% for album in albums %}
        <div class="tile-item album-item" data-album-artist="{% if album.artists.all.count > 3 %}various Artists{% else %}{% for artist in album.artists.all %}{{artist.name | lower }} {% endfor %}{% endif %}" data-album-name="{{ album.name|lower }}">
            <a href="{% url 'album-detail' album.pk %}">
                <div class="album-art">
                    {% if album.picture %}
                        <div class="album-image" style="background-image: url('{{ album.picture }}')" alt="{{ album.name }} cover"></div>
                    {% else %}
                        <div class="placeholder-image">üíø</div>
                    {% endif %}
                </div>
                <div class="tile-info">
                    <h3 class="album-name">{{ album.name }}</h3>
                    {% if album.artists.all.count > 3 %}
                        <p>Various Artists</p>
                    {% else %}
                        {% for artist in album.artists.all %}
                        <p>
                            {{artist.name}}
                        </p>
                        {% endfor %}
                    {% endif %}
                </div>
            </a>
        </div>
    {% empty %}
        <p id="no-albums-message">No se encontraron √°lbumes.</p>
    {% endfor %}
</div>

<!-- Scripts de JavaScript para el filtrado -->
<script>
    function filterAlbums() {
        // Obtener el valor de b√∫squeda y convertirlo a min√∫sculas
        const input = document.getElementById('searchInput');
        const counter = document.getElementById('album-count');
        const filter = input.value.toLowerCase();
        
        // Obtener todos los elementos de la lista de √°lbumes
        const albumCards = document.querySelectorAll('.album-item');
        const noAlbumsMessage = document.getElementById('no-albums-message');
        
        let found = false;
        let count = 0;
        // Iterar sobre todas las tarjetas y ocultar las que no coinciden
        albumCards.forEach(card => {
            const name = card.getAttribute('data-album-name').toLowerCase();
            const artist = card.getAttribute('data-album-artist').toLowerCase();
            
            if (name.includes(filter) ||artist.includes(filter)) {
                card.style.display = ""; // Mostrar el elemento (default block/grid item)
                found = true;
                count++;
            } else {
                card.style.display = "none"; // Ocultar el elemento
            }
        });
        counter.innerHTML = count;
        // Manejar el mensaje de "no encontrados" si es necesario
        if (noAlbumsMessage) {
            noAlbumsMessage.style.display = found ? "none" : "";
        }
    }
</script>

{% endblock %}
