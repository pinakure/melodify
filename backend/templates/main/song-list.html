{% load static %}
{% load fontawesome_5 %}
{% load utils %}

<div class="song-list">
    <div class="counter medium">
        <h3>{{ data.count }} Pistas</h3> 
    </div>    
    {% csrf_token %}
    {% for song in data %}
    <div class="tile-item song-item" data-song-name="{{ song.title|lower }}">
        
        <div class="song-tracknumber">{{ forloop.counter }}</div>
        
        <button 
            class="play-button" 
            data-artistname="{{ song.artist.name }}" 
            data-songname="{{ song.title }}" 
            data-src="/static/{{ song.filename }}" 
            id="song-{{ song.pk }}"
            data-id="{{ song.pk }}"
            {% if not forloop.last %}
                data-next-id="{{ data|get_next_song_id:forloop.counter0 }}"
            {% else %}
                data-next-id="{{ data.0.id }}"
            {% endif %}
            onclick="melodify.playSong(this)">
            <div class="playBtn"></div>
        </button>
        
        <div class="song-art">
            {% if song.picture %}
                <div class="song-image" style="background-image: url('{{ song.picture }}')" alt="{{ song.title }} cover"></div>
            {% else %}
                <div class="placeholder-song-image"><span>ðŸ’¿</span></div>
            {% endif %}
        </div>
        
        <div class="song-info">
            <a onclick="melodify.navigate(`{% url 'song-detail' pk=song.pk %}`)">
                <h4 class="song-name">{{ song.title }}</h4>
                <p class="song-artist small">{{ song.artist }}</p>
            </a>
        </div>
        
        <div class="tile-buttons" style="float: right; z-index: 1000;">
            <p class="small">{{ song.duration|strftime:"%H:%i:%s" }}</p>                    
            <div style="display: flex" >
                <button type="button" id="bookmark-song-{{ song.pk }}"      class="input transparent {% if song.bookmarked == True  %}hidden{% endif %}" title="Agregar a Favoritos"       onclick="melodify.bookmarkSong('{{ song.id }}', false)">{% fa5_icon 'heart' color="#8888"%}</button>
                <button type="button" id="unbookmark-song-{{ song.pk }}"    class="input transparent {% if song.bookmarked == False %}hidden{% endif %}" title="Eliminar de Favoritos"     onclick="melodify.bookmarkSong('{{ song.id }}', false)">{% fa5_icon 'heart' color="#ffff"%}</button>
                <!-- <button type="button" id="enqueue-song"     class="input confirm" title="Agregar a lista actual"    onclick="melodify.enqueueSong('{{ song.artist.name }}', '{{ song.title }}' ,'/static/{{ song.filename }}' ,'song-{{ song.pk }}', '{{ song.pk }}')">{% fa5_icon 'plus' color="#000"%}</button> -->
                <button type="button" id="show-playlists"   class="input confirm" title="AÃ±adir a lista"            onclick="melodify.showPlaylists( this, '{{ song.pk }}' )">{% fa5_icon 'list' color="#000"%}</button>
                <button type="button" id="delete-entry"     class="input accent"  title="Eliminar de la lista"      onclick="melodify.remSongFromPlaylist('{{ playlist.id }}', '{{ song.pk }}')">{% fa5_icon 'trash' color="#000"%}</button>
            </div>
        </div>

    </div>
        
    {% empty %}
    <p id="no-songs-message">No se encontraron canciones.</p>
    {% endfor %}
</div>

