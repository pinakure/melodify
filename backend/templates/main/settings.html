<!-- main/settings.html -->
{% load utils %}
{% load fontawesome_5 %}
{% include "main/widget-title.html" with caption="Ajustes" %}
{% include "main/widget-back.html" %}
{% csrf_token %}
<style>
    .swatch {
        display: inline-block;
        box-sizing: border-box;
        width: 5%;
        height: 32px;
        border: 1px solid #0008;
    }
    .swatch:hover {
        border: 1px dotted var(--accent-color);
    }
    .swatch.active {
        border: 1px solid #f00;
    }   
</style>
{% include 'main/widget-section.html' with caption="Estilo Visual" icon="eye" %}
<!-- opciones visuales  -->
<div id="scheme-wrapper" style="margin: 4px; width: 100%; height: 40px; align-items: center; display: flex;">
    <label for="{{ id }}" >
        {% fa5_icon "palette" %}&nbsp;
        <div style="display: inline-block; width: 160px; text-align: left;">
            Tema de Color
        </div>
    </label>
    <select onchange="melodify.loadScheme( this.value ); melodify.saveState();" class="input" style="width: 50%" id="schemes">
        <option value="">-------------</option>
        {% for scheme in schemes %}
        <option value="{{ scheme.name }}">{{ scheme.name|capfirst }}</option>
        {% endfor %}
    </select>
</div>
<div id="swatches"      style="width: calc(100% - 200px); margin-left: auto;margin-right: 10px;"></div>
<div id="swatch-tweak" style="width: calc(100% - 200px); margin-left: auto; margin-right: 10px; background: var(--bg-main); padding: 20px; border-radius: 8px;">
    <div style="background: rgba(0,0,0,0.5); padding: 15px; color: white; display: flex; flex-direction: column; gap: 10px; border-radius: 5px;">
        <div style="height: 32px;max-height: 32px; display: flex; justify-content: center; align-items: center; "><i class="fa fa-circle" style="color:#f00"></i>&nbsp;<input style="width: calc(100% - 64px); height: 32px; margin: 0px; padding: 0px;" type="range" id="r-range" min="0" max="255" value="40"> <span id="r-val">40</span></div>
        <div style="height: 32px;max-height: 32px; display: flex; justify-content: center; align-items: center; "><i class="fa fa-circle" style="color:#0f0"></i>&nbsp;<input style="width: calc(100% - 64px); height: 32px; margin: 0px; padding: 0px;" type="range" id="g-range" min="0" max="255" value="41"> <span id="g-val">41</span></div>
        <div style="height: 32px;max-height: 32px; display: flex; justify-content: center; align-items: center; "><i class="fa fa-circle" style="color:#00f"></i>&nbsp;<input style="width: calc(100% - 64px); height: 32px; margin: 0px; padding: 0px;" type="range" id="b-range" min="0" max="255" value="61"> <span id="b-val">61</span></div>
        
        <div style="margin-top: 10px;">
            <strong>Resultado: </strong> <span id="hex-code">#28293d</span>
        </div>
    </div>
</div>
{% include 'main/widget-checkbox.html'  with id="use-renderer"          caption="Visualización"         value=False                 icon="music"     onclick="melodify.toggleAnalyzer()" %}
<hr class="breathe" style="border: 1px solid #f0f0f008"/>
<!-- rutas  -->
{% include 'main/widget-input.html'     with id="library-root"          caption="Carpeta de Música"     value=library_root          icon="file" %}
<hr class="breathe" style="border: 1px solid #f0f0f008"/>
{% include 'main/widget-input.html'     with id="spotify-client-id"     caption="<p class='italic'>Spotify Client ID</p>"     value=spotify_client_id     icon="user" %}
{% include 'main/widget-input.html'     with id="spotify-client-secret" caption="<p class='italic'>Spotify Client Secret</p>" value=spotify_client_secret icon="key" %}
{% include 'main/widget-input.html'     with id="discogs-api-token"     caption="<p class='italic'>Discogs API Token</p>"     value=discogs_api_token     icon="compact-disc" %}


<script>

    function Colorizer(){

    }

    const colorizer = new Colorizer();

    const rInput = document.getElementById('r-range');
    const gInput = document.getElementById('g-range');
    const bInput = document.getElementById('b-range');

    const rVal = document.getElementById('r-val');
    const gVal = document.getElementById('g-val');
    const bVal = document.getElementById('b-val');

    const hexCode = document.getElementById('hex-code');
    const target = document.getElementById('swatch-tweak');

    function updateColor() {
        const r = rInput.value;
        const g = gInput.value;
        const b = bInput.value;

        // Actualizar etiquetas de texto
        rVal.textContent = r;
        gVal.textContent = g;
        bVal.textContent = b;

        // Convertir a HEX para mostrarlo
        const hex = "#" + [r, g, b].map(x => {
            const h = parseInt(x).toString(16);
            return h.length === 1 ? '0' + h : h;
        }).join('');
        
        hexCode.textContent = hex;

        // APLICAR AL CSS: Actualiza la variable para que el fondo cambie
        document.documentElement.style.setProperty('--bg-main', hex);
    }

    // Escuchar eventos
    [rInput, gInput, bInput].forEach(input => {
        input.addEventListener('input', updateColor);
    });

    // Inicializar al cargar
    // updateColor();

    let elements = [
        'bg-main',
        'bg-nav',
        'bg-sidebar',
        'bg-sidebar-selection',
        'bg-sidebar-hover',
        'bg-content-blend',
        'bg-content',
        'text-color',
        'secondary-color',
        'link-color',
        'section-color',
        'confirm-color',
        'accent-color',
        'bg-player-title',
        'shadow-color',
        'tile-placeholder',
        'tile-info',
        'tile-info-text',
        'gradient-begin',
        'gradient-end',
    ];
    melodify.node('schemes').value=melodify.state.settings.scheme;
    let colors = {};
    document.getElementById('swatches').innerHTML = '';
    
    for( i in elements){
        
        document.getElementById('swatches').innerHTML += `<div 
                title="${ elements[i] }" 
                id="${ elements[i] }" 
                class="swatch" 
                onclick="document.getElementsByClassName('swatch').forEach((swatch)=>swatch.className = 'swatch'); this.className='swatch active';"
                style="background-color: var(--${elements[i]})"
        ></div>`;
    }
    for( i in elements){
        colors[ elements[i] ] = getComputedStyle(document.getElementById(elements[i])).getPropertyValue(`--${ elements[i] }` ).trim();
    }
    melodify.node('use-renderer').checked = melodify.state.enable_analyzer; 
</script>